# .github/workflows/cypress-tests.yml

name: Testes Cypress

on: [push]

jobs:
  cypress-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout do código
        uses: actions/checkout@v4

      # A action oficial do Cypress. Ela vai:
      # 1. Instalar o pnpm (porque detecta o arquivo pnpm-lock.yaml)
      # 2. Rodar "pnpm install" para instalar as dependências do projeto
      # 3. Instalar o binário do Cypress e salvá-lo em cache
      # 4. Iniciar seu servidor com "pnpm dev"
      # 5. Esperar o servidor responder na porta 8080
      # 6. Rodar os testes
      - name: Executar testes Cypress
        uses: cypress-io/github-action@v6
        with:
          start: pnpm dev
          wait-on: 'http://localhost:8080' # Ajuste a porta se for diferente
          record: true
        env:
          # A chave continua sendo passada de forma segura
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
